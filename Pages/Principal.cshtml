@page
@model PrincipalModel
@{
    ViewData["Title"] = "Dashboard Principal";
    Layout = "_LayoutGeneral";
}
@using InventarioComputo.Security
@inject PermisosService Perms

<div class="dashboard-container">
    <div class="dashboard-bienvenida">
        <h1 class="beige-text">Bienvenido/a, <span id="username-display">@Model.NombreUsuario</span></h1>
        <p class="beige-light">Sistema de Inventario de Computo - La Armería</p>
        <p class="beige-light">Rol: @Model.RolUsuario</p>
    </div>

    <div class="row mt-4">

        <div class="col-lg-4 col-md-5">
            <h3 class="beige-text">Módulos Principales</h3>
            <div class="module-buttons">
                <a href="/Inventario" class="module-btn">
                    <i class="fas fa-laptop"></i>
                    <div class="module-btn-text">
                        <h5>Activos Fijos</h5>
                        <p>@Model.TotalActivosFijos Registrados</p>
                    </div>
                </a>

                <a href="/Mantenimientos" class="module-btn">
                    <i class="fas fa-tools"></i>
                    <div class="module-btn-text">
                        <h5>Mantenimientos</h5>
                        <p>@Model.TotalMantenimientos Registrados</p>
                    </div>
                </a>

                <a href="/EquiposRegistrados" class="module-btn">
                    <i class="fas fa-list-alt"></i>
                    <div class="module-btn-text">
                        <h5>Equipos Registrados</h5>
                        <p>@Model.TotalEquiposRegistrados Perfiles</p>
                    </div>
                </a>

                <a href="/Departamentos" class="module-btn">
                    <i class="fas fa-sitemap"></i>
                    <div class="module-btn-text">
                        <h5>Departamentos</h5>
                        <p>@Model.TotalDepartamentos Registrados</p>
                    </div>
                </a>

                @* Empleados / Usuarios: visibles solo si tiene permisos de VER *@
                @if (await Perms.TieneAsync(User, PermisosConstantes.VerEmpleados))
                {
                    <a href="/Empleados" class="module-btn">
                        <i class="fas fa-users"></i>
                        <div class="module-btn-text">
                            <h5>Empleados</h5>
                            <p>@Model.TotalEmpleados Registrados</p>
                        </div>
                    </a>
                }

                @if (await Perms.TieneAsync(User, PermisosConstantes.VerUsuarios))
                {
                    <a href="/Usuarios" class="module-btn">
                        <i class="fas fa-user-shield"></i>
                        <div class="module-btn-text">
                            <h5>Usuarios</h5>
                            <p>@Model.TotalUsuarios Registrados</p>
                        </div>
                    </a>
                }
            </div>
        </div>

        <div class="col-lg-8 col-md-7">
            <div class="quick-access">
                <h3 class="beige-text">Accesos Rápidos</h3>
                <div class="quick-links">
                    @* Crear nuevo Activo: requiere ModificarActivos *@
                    @if (await Perms.TieneAsync(User, PermisosConstantes.ModificarActivos))
                    {
                        <a href="/Inventario/Formulario" class="quick-link beige-dark">
                            <i class="fas fa-plus"></i>
                            <span>Nuevo Activo</span>
                        </a>
                    }

                    @* Asignar Equipo: lo atamos a ModificarEquipos *@
                    @if (await Perms.TieneAsync(User, PermisosConstantes.ModificarEquipos))
                    {
                        <a href="/Asignaciones" class="quick-link beige-dark">
                            <i class="fas fa-user-tie"></i>
                            <span>Asignar Equipo</span>
                        </a>
                    }

                    @* Reportes: visible si puede VER reportes *@
                    @if (await Perms.TieneAsync(User, PermisosConstantes.VerReportes))
                    {
                        <a href="/Reportes" class="quick-link beige-dark">
                            <i class="fas fa-chart-bar"></i>
                            <span>Generar Reporte</span>
                        </a>
                    }

                    @* Nuevo Usuario: requiere ModificarUsuarios *@
                    @if (await Perms.TieneAsync(User, PermisosConstantes.ModificarUsuarios))
                    {
                        <a href="/Usuarios/FormularioUsuario" class="quick-link beige-dark">
                            <i class="fas fa-user-plus"></i>
                            <span>Nuevo Usuario</span>
                        </a>
                    }

                    @* Bitácora: visible si tiene permiso de VER Bitácora *@
                    @if (await Perms.TieneAsync(User, PermisosConstantes.VerBitacora))
                    {
                        <a href="/Bitacora" class="quick-link beige-dark">
                            <i class="fas fa-book"></i>
                            <span>Bitácora</span>
                        </a>
                    }
                </div>
            </div>

            <div class="statistics-section mt-4">
                <h3 class="beige-text">Estadísticas Clave</h3>

                <div class="row">
                    <div class="col-lg-6 mb-3">
                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-hourglass-end"></i></div>
                            <div class="stat-content">
                                <div class="stat-value">@Model.ActivosPorVencer</div>
                                <div class="stat-title">Activos con &lt; 1 año de vida útil</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6 mb-3">
                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-boxes-stacked"></i></div>
                            <div class="stat-content">
                                <div class="stat-value">@Model.EquiposAsignados / @Model.EquiposSinAsignar</div>
                                <div class="stat-title">Asignados vs. Sin Asignar</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-6 mb-3">
                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-tools"></i></div>
                            <div class="stat-content">
                                <div class="stat-value">@Model.MantenimientosUltimoMes</div>
                                <div class="stat-title">Mantenimientos (Últimos 30 días)</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6 mb-3">
                        <div class="list-card">
                            <h6 class="list-card-header">
                                <i class="fas fa-sitemap"></i> Top Departamentos
                            </h6>
                            <div class="list-card-body">
                                @if (Model.TopDepartamentos.Any())
                                {
                                    <ul class="list-group list-group-flush">
                                        @foreach (var depto in Model.TopDepartamentos.Take(3))
                                        {
                                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                                @depto.NombreDepartamento
                                                <span class="badge bg-beige-dark rounded-pill">@depto.CantidadEquipos</span>
                                            </li>
                                        }
                                    </ul>
                                }
                                else
                                {
                                    <p class="text-muted p-2">Sin datos.</p>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

@section Styles {
    <link rel="stylesheet" href="~/Styles/Style_Principal.css" asp-append-version="true" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
}
